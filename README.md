# Soa
web servis entegrasyonlarını örnekleyecek bir proje oluşturmak amaçlanmaktadır, bu noktada projenin adı “Kurumsal Mimaride Web Servis Entegrasyonu” olarak belirlenmiştir. Proje 4 aşamadan meydana gelmektedir.

İlk aşamada internetten “CountryInfoService” isimli hazır bir web servisin bulunması gerekmektedir. Daha sonra bu web servisin “CountryISOCode” ve “FullCountryInfo” isimli iki operasyonu tercih edilerek SOAP UI arayüzünden istekte bulunulup cevap alınması beklenmektedir. CountryISOCode ülkenin adı girildiğinde (örneğin “Turkey”) ülkenin ISO kodunu cevap olarak döndürür. FullCountryInfo ise ülkenin ISO kodu girildiğinde (örneğin “TR”) ülkenin ISO kodunu, ismini, başkentini, telefon kodunu, kıta kodunu, para birimini, bayrağını ve dillerini cevap olarak döndürür. İsteğe karşılık gelen cevap başarılıysa bu aşama sonlandırılarak bir sonraki aşamaya geçilir.

İkinci aşamada ise internette bulunan bu servisi kullanarak başka bir servis oluşturmak amaçlanmaktadır. Burada bir OSB Provider oluşturulur ve bunun amacı EBF’ten çağrı yapabilmektir. Burası müşteriye ya da çağrı yapacak sistemlere açık değildir yani internal bir servistir dolayısıyla EBF’ten çağrılacaktır. Provider, CountryInfo servisinden veri çekilmesini sağlayan sağlayıcıdır denebilir. Bu noktada OSB (Oracle Service Bus)’ye ulaşmak için öncelikle bir BS (Business Service) yazılır. Web’te bulunan servisi sunucuya dağıtarak business service üzerinden OSB’ye çağrı yapılır. BS, internetten alınan servisin WSDL’ını kullanarak bu aşamayı gerçekleştirir.
Daha sonra OSB için bir Proxy service yazılır bu servisle kullanılacak iki operasyona bir arayüz oluşturulur. Burada kendi WSDL’ımız ve XSD’imiz oluşturulur. Bu farkı anlamak için WSDL ve XSD Türkçe biçimde yazılacaktır. Bu servis de SOAP UI’dan çağrılabilir bir servis olacaktır böylece Proxy service ile oluşturulan arayüzden SOAP UI’a çağrı yapılabilecek hale getirilir. Proxy service BS’yi çağıracak ve BS’de CountryInfo servise gidecek. 

Üçüncü aşamada Enterprise Service Bus (ESB)’ta veritabanı işlemlerini yöneteceğimiz EBF (Enterprise Business Flow) yazılacaktır. Burada da SOAP UI’dan çağrılabilir kendi yazdığımız WSDL ve XSD’lerin olduğu bir servis yazılmış olacak. EBF’den OSB’ye, OSB’den BS’ye ve oradan da CountryInfo servise gidip daha sonra buradaki bilgileri dönen bir servis yazılmış olacak. Ondan sonra bu aşamada yapılan çağrılar ilk önce veritabanına gidip kayıtlar var mı diye bakacak tablolarda bu veriler varsa web servise gitmeden direkt veritabanından response dönecek, eğer kayıt yoksa bu verileri alacak dönmeden önce bu verileri veritabanına kaydedecek (bir sonraki çağrılarda kullanılmak amacıyla kaydedilir) ardından reponse dönecek. 

Dördüncü aşamada EBF’e çağrı yapmak amacıyla bir OSB Requester yazılır. Bu servis müşteriye açık bir servistir yani dışarıdan çağrı yapılabilir. Requester sorgulayıcı olarak düşünülebilir yani farklı sistemler requesterı tetikleyerek veritabanından veya uç sistemden verileri elde edecek ayrıca burada da EBF’e ulaşmak için bir business service kullanılacaktır. Bu aşamada Soap şekilde çalışan servisi rest arayüzüne çevirilecek fonksiyonalite kazandırılacaktır bunun yanı sıra güvenlik amaçlı authentication eklenecek yani ortamın sunucu bilgilerini, token bilgisini (username-pasword) girmeden servise çağrı yapılamayacak ve bu şekilde de bir güvenlik ara katmanı konulmuş olacak.

Proje Özeti

Osb Requester bir çağrı karşılayıcısıdır, dışarıdan gelen isteği karşılayan yapıdır. Örneğin kullanıcı ülke bilgisini girdi ve karşılığında tüm ülke bilgilerini istedi. Bu durumda bu isteği alır ve ilk iş göndereceği servise göre kendi tiplerini dönüştürmektir. 
Öncelikle EBF gideceğini bilir bu nedenle örneğin “GET_ISO_CODE_REQ_TYPE” inputunu gönderirken EBF’te karşılığı “CountryInfoCheckEBFRequestMessage” olduğu için burada bir transforma sokar ve yapıyı kendi diline dönüştürür daha sonra EBF’te bunu bir OSB Provider’a yani bir sağlayıcıyı göndermesi gerekmektedir bu nedenle oraya göndermek için bu sefer de Provider’ın tipine uygun bir transform yapar yani “CountryInfoCheckEBFRequestMessage” dan “alISOKodType”a dönüştürür. Provider bu bilgiyi dış serviste bulunan CountryInfo serisinin WSDL’ınden alacaktır bu nedenle bir BS kullanılması gerekmektedir çünkü OSB ortamından herhangi bir servise gidildiğinde BS kullanımına ihtiyaç duyulur. 
Daha sonra provider kendi tipini dış servisin tipine dönüştürerek dönen cevabı alır dolayısıyla burada da transform kullanılır. Gelen cevap yine aynı yolun tersi yönüyle devam eder ve son olarak kullanıcının istekte bulunduğu noktaya döner. 
Bu sırada kullanıcı istekte bulunurken bir kullanıcı adı ve şifre isteyen sistem kullanılmıştır böylece kimlik doğrulama gerçekleştirilmezse kullanıcı istekte bulunamaz. 
Bunların yanı sıra SOAP türünde dönen bir cevabı REST türüne dönüştürmeyi sağlayan bir mekanizma düşünülmüş ve OSB ortamında tasarlanmıştır. 
Daha sonra EBF’in sürekli Provider’a gitmesinden ziyade daha önce çağrısı yapılan verileri bir yere kaydetse ve bu verileri bir kez daha çağrı yapıldığında buradan alınsa proje maliyeti azaltılmış olmaz mı düşüncesiyle yola çıkarak bir veritabanı kullanılır ve veriler buraya kaydedilir, sonra kullanıcı aynı veri için ikinci kez istekte bulunduğunda bu veri, veritabanından çekilir.
Böylece ara katmanda akış yukarıda belirtildiği biçimde gerçekleşir.
Aşağıda da projenin detaylı iş akış şeması bulunmaktadır.

